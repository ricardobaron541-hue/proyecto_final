<!DOCTYPE html>
<!-- Documento HTML donde se muestra el detalle individual de un producto -->
<html lang="es">
<head>
    <meta charset="UTF-8"> <!-- Define codificación de caracteres -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ajuste responsivo -->
    <title>{{ titulo }}</title> <!-- Título dinámico con el nombre del producto -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> <!-- Vincula hoja CSS -->
</head>

<body>

<!-- CONTENEDOR GENERAL DEL FONDO -->
<div class="detalle-fondo"> <!-- Fondo decorativo para la página de detalle -->
    <div class="detalle-container"> <!-- Contenedor principal que alinea imagen e información -->

        <!-- ---------------- GALERÍA (SOLO IMAGEN PRINCIPAL) ---------------- -->
        <div class="detalle-galeria"> <!-- Sección donde va la imagen grande del producto -->

            <div class="detalle-imagen-principal"> <!-- Contenedor de la imagen principal -->
                <img id="imgPrincipal" src="{{ imagen }}" alt=""> <!-- Imagen cargada dinámicamente -->
            </div>

        </div>

        <!-- ---------------- INFORMACIÓN DEL PRODUCTO ---------------- -->
        <div class="detalle-info"> <!-- Contenedor del texto y botones del producto -->

            <!-- TÍTULO DEL PRODUCTO -->
            <h1 class="detalle-titulo">{{ titulo }}</h1> <!-- Nombre dinámico -->

            <!-- PRECIO DEL PRODUCTO -->
            <h2 class="detalle-precio">$ {{ precio }} </h2> <!-- Precio dinámico -->

            <div class="separador"></div> <!-- Línea divisoria -->

            <!-- DESCRIPCIÓN DEL PRODUCTO -->
            <p class="detalle-descripcion"> <!-- Descripción dinámica -->
                {{ descripcion }}
            </p>

            <!-- FORMULARIO PARA AGREGAR AL CARRITO -->
            <form id="formAgregarCarrito" action="/agregar_carrito" method="POST"> <!-- POST para enviar datos al servidor -->
                <!-- Campos ocultos para enviar información del producto -->
                <input type="hidden" name="titulo" value="{{ titulo }}"> <!-- Enviar nombre -->
                <input type="hidden" name="precio" value="{{ precio }}"> <!-- Enviar precio -->
                <input type="hidden" name="imagen" value="{{ imagen }}"> <!-- Enviar imagen -->
    
                <button class="btn-carrito" type="submit">AGREGAR AL CARRITO</button> <!-- Botón principal -->
            </form>

            <!-- BOTÓN PARA VOLVER A LA PÁGINA ANTERIOR -->
            <button onclick="window.history.back()" class="btn-volver">Volver</button> <!-- Regresa a la página anterior -->

        </div>

    </div>

</div>

<!-- MENSAJE EMERGENTE AL AGREGAR AL CARRITO -->
<div id="mensajeAgregado"> <!-- Oculto por defecto, aparece cuando el producto se agrega -->
    Producto agregado con éxito ✔️
</div>


<!-- ---------------- SCRIPT PARA AGREGAR AL CARRITO SIN RECARGAR ---------------- -->
<script>
document.addEventListener("DOMContentLoaded", () => { // Espera a que cargue toda la página
    const form = document.querySelector("#formAgregarCarrito"); // Selecciona el formulario

    form.addEventListener("submit", async function(e){
        e.preventDefault();  // Evita recargar la página durante el envío
        
        const formData = new FormData(form); // Crea un contenedor con los datos del formulario

        let respuesta = await fetch("/agregar_carrito", { // Enviar datos al backend
            method: "POST",
            body: formData
        });

        // Si el backend responde "OK", mostrar mensaje animado
        if(await respuesta.text() === "OK"){
            let msg = document.getElementById("mensajeAgregado");
            msg.style.display = "block"; // Mostrar mensaje

            setTimeout(() => { // Oculta el mensaje después de 2 segundos
                msg.style.display = "none";
            }, 2000);
        }
    });
});
</script>

</body>
</html>